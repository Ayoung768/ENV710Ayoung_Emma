---
title: "dolphin_strandings"
author: "Emma Beyer & Ayoung Kim"
date: "2024-02-27"
output: pdf_document
---

```{r output setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup}
#loading packages
library(tidyverse)
library(ggplot2)
library(GGally)
library(rmarkdown)
#setting WD
setwd("/home/guest/Stat_Modeling_Lab/ENV710Ayoung_Emma")

#read in data for problems 1-2
strandings <- read.csv("dolphins_cleaned.csv")
#attach data
attach(strandings)

```

## Data Cleaning

```{r}
#remove NAs
cleaned_strandings <- na.omit(strandings)

#remove unneeded covariates
cleaned_strandings <- subset(cleaned_strandings, select = -c(Shot, Fishery.Interaction))

#removing blanks in Age.Class
cleaned_strandings <- cleaned_strandings[!grepl("^\\s*$", cleaned_strandings$Age.Class), ]
#removing unknowns in Age.Class
cleaned_strandings <- cleaned_strandings[!cleaned_strandings$Age.Class %in% c("UNKNOWN"), ]
#removing unknowns in Sex
cleaned_strandings <- cleaned_strandings[!cleaned_strandings$Sex %in% c("UNKNOWN"), ]

#create binary covariate for wind turbine presence in state
cleaned_strandings <- cleaned_strandings %>%
  mutate(turbine_presence = if_else(State %in% c("VA", "NY", "RI", "MA"), 1, 0))

write.csv(cleaned_strandings, "cleaned_strandings", row.names = FALSE)
#strandings_test <- read.csv("cleaned_strandings")


#creating subset using collision observations
subset <- cleaned_strandings[!grepl("^\\s*$", cleaned_strandings$Boat.Collision), ]

#create new csv file for future editing
subset <- subset[!subset$Boat.Collision %in% c("C"), ]

#count of strandings in wind farm states = 6
sum(subset$turbine_presence)

#count of strandings in turbine states = 11
sum(cleaned_strandings$turbine_presence)

```

```{r plots}
#visualizing length and weight by presence of turbines
plot <- ggplot(cleaned_strandings, aes(x = Length, y = Weight, color = as.factor(turbine_presence))) +
  geom_point()
plot

#I like visualizing this data better with box plots
age_class_order <- c("PUP/CALF", "YEARLING", "SUBADULT", "ADULT")

boxplot1 <- ggplot(cleaned_strandings, aes(x = factor(Age.Class, levels = age_class_order), y = Weight)) +
  geom_boxplot(color="skyblue") +
  labs(x = "Age Class", y = "Weight") +
  ggtitle("Dolphin Weight by Age Class")
boxplot1

boxplot2 <- ggplot(cleaned_strandings, aes(x = factor(Age.Class, levels = age_class_order), y = Length)) +
  geom_boxplot(color="skyblue") +
  labs(x = "Age Class", y = "Length") +
  ggtitle("Dolphin Length by Age Class")
boxplot2

state_plot <- ggplot(cleaned_strandings, aes(x = State, y = Length)) +
  geom_boxplot(color="skyblue") +
  labs(x = "States", y = "Length") +
  ggtitle("Dolphin Length by State")
state_plot

subset_turbines <- filter(cleaned_strandings, State %in% c("VA", "NY", "RI", "MA"))

state_turbines <- ggplot(subset_turbines, aes(x = State, y = Length)) +
  geom_boxplot(color="skyblue") +
  labs(x = "States", y = "Length") +
  ggtitle("Dolphin Length by State")
state_turbines

state_turbines2 <- ggplot(subset_turbines, aes(x = State, y = Weight)) +
  geom_boxplot(color="skyblue") +
  labs(x = "States", y = "Weight") +
  ggtitle("Dolphin Length by State")
state_turbines2


#visualizing weight by age class
avg_weight <- aggregate(Weight ~ Age.Class, data = cleaned_strandings, FUN = mean)

avg_weight <- avg_weight[order(-avg_weight$Weight), ]

plot1 <- ggplot(avg_weight, aes(x = reorder(Age.Class, Weight), y = Weight)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Age Class", y = "Average Weight") +
  ggtitle("Average Weight by Age Class")
plot1

#visualizing length by age class
avg_lengths <- aggregate(Length ~ Age.Class, data = cleaned_strandings, FUN = mean)

avg_lengths <- avg_lengths[order(-avg_lengths$Length), ]

plot2 <- ggplot(avg_lengths, aes(x = reorder(Age.Class, Length), y = Length)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Age Class", y = "Average Length") +
  ggtitle("Average Length by Age Class")
plot2

#visualizing sex by presence of turbines
plot3 <- ggplot(cleaned_strandings, aes(x = Sex, fill = factor(turbine_presence))) +
  geom_bar(position = "stack") +
  labs(x = "Sex", y = "Count", fill = "Presence of Turbines") +
  ggtitle("Sex vs Presence of Turbines")
plot3

#visualizing age class by presence of turbines
age_class_order <- c("PUP/CALF", "YEARLING", "SUBADULT", "ADULT")

plot4 <- ggplot(cleaned_strandings, aes(x = factor(Age.Class, levels = age_class_order), fill = factor(turbine_presence))) +
  geom_bar(position = "stack") +
  labs(x = "Age Class", y = "Count", fill = "Presence of Turbines") +
  ggtitle("Age Class vs Presence of Turbines")
plot4

```
